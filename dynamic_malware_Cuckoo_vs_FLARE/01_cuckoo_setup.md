# Cuckoo Sandbox — Detailed Setup Guide (Recommended Host: Ubuntu 22.04 LTS) — 2025

This guide gives a practical, secure setup for Cuckoo Sandbox v2.x on an isolated host suitable for malware analysis. It follows the official Cuckoo documentation and common up-to-date community practices.

> **Prerequisites & security notes**
- Run all malware analysis on an isolated network (air-gapped or virtual host-only network). Do NOT connect analysis guests to your main LAN/Internet without careful network controls (proxy / NAT / PCAP mirroring rules).  
- Use snapshots for quick revert; keep host patched; avoid running untrusted binaries on the host.  
- Keep Cuckoo components up-to-date from the official repo: https://cuckoo.readthedocs.io and https://github.com/cuckoosandbox/cuckoo.

## Host OS & Hardware (recommended)
- Host OS: **Ubuntu 22.04 LTS** (or recent Debian stable). Official docs traditionally recommend Ubuntu/Debian variants. Ubuntu 20.04/22.04 are commonly used. citeturn0search0  
- CPU: 4+ physical cores (more cores if you run parallel guests).  
- RAM: 16–32 GB (8GB minimum; guests will consume RAM).  
- Disk: 200+ GB (guest images, PCAPs, and artifacts grow fast).  
- Virtualization: KVM/libvirt recommended for performance; VirtualBox or VMware also supported.

## High-level architecture
- **Cuckoo host** (Linux): runs the Cuckoo server, processing modules, database (PostgreSQL or MongoDB), and hypervisor management.  
- **Guest VMs** (Windows, Linux): instrumented with Cuckoo agent; snapshots prepared for each analysis run.  
- **Network proxy / monitoring**: optional transparent proxy or controlled Internet access via a dedicated gateway; PCAP capture interface.

## Installation summary (commands are illustrative — run in a controlled lab)
1. Update host and install prerequisites (Ubuntu 22.04 example)
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y python3 python3-venv python3-pip python3-dev   libffi-dev libssl-dev libjpeg-dev zlib1g-dev swig build-essential   qemu-kvm libvirt-daemon-system libvirt-clients virtinst bridge-utils   libguestfs-tools mongodb postgresql libpq-dev git
```
- Note: Cuckoo supports PostgreSQL or MongoDB for storage; choose one. Official docs describe supported DBs. citeturn0search5

2. Create a dedicated user and Python virtualenv
```bash
sudo useradd -m -s /bin/bash cuckoo
sudo passwd cuckoo
sudo su - cuckoo
python3 -m venv ~/cuckoo-venv
source ~/cuckoo-venv/bin/activate
```

3. Install Cuckoo from PyPI / GitHub
```bash
pip install --upgrade pip setuptools wheel
# Option A: pip install latest stable
pip install -U cuckoo
# Option B: install from source (recommended for latest features)
git clone https://github.com/cuckoosandbox/cuckoo.git
cd cuckoo
pip install -r requirements.txt
pip install -e .
```
(See official docs for the exact dependency list and recommended install method). citeturn0search11turn0search18

4. Configure virtualization & libvirt (KVM)
- Install and enable libvirt and qemu as above. Add `cuckoo` user to `libvirt` and `kvm` groups:
```bash
sudo usermod -aG libvirt cuckoo
sudo usermod -aG kvm cuckoo
```
- Ensure nested virtualization enabled in BIOS for host if you plan nested guests.

5. Prepare guest VMs
- Create clean snapshots for each guest (example guests): Windows 10/11 (x64), Windows 7 (if needed), Debian for Linux analysis. Recommended guest tools:
  - Install Python and the Cuckoo agent (or the guest agent provided in Cuckoo docs) in each VM.  
  - Turn off Windows Defender real-time protections in guests used for analysis (isolated lab only).  
  - Create a snapshot named `clean` for quick revert.

6. Configure Cuckoo (conf/ files)
- Edit `~/.cuckoo/conf/cuckoo.conf`, `~/.cuckoo/conf/aux.conf`, `~/.cuckoo/conf/reporting.conf` per your environment. Configure DB connection, processing limits, machine mapping, and network (interface for pcap capture). Official docs detail config fields. 

7. Start services and web UI
```bash
# as cuckoo user and venv activated
cuckoo community --help   # optional community modules
cuckoo --help
cuckoo
# Start the web UI (if installed)
# The installation may provide cuckoo-web or a separate web interface; see docs.
```

## Network considerations
- Use a dedicated virtual network for guest traffic. If you must allow Internet, proxy it via a controlled gateway (Squid) and log all traffic. Configure DNS to route via a safe resolver or sinkhole. Capture PCAPs on the host bridge interface.

## Best practices & tips
- Use snapshots and immutable guest images; revert after each run.  
- Limit sample runtime and resource usage to avoid long-running callbacks.  
- Keep the host isolated and use a separate analysis subnet.  
- Regularly update Cuckoo & guest agent; subscribe to upstream docs for breaking changes. 

## Useful links
- Official Cuckoo docs (installation & configuration). 
- Cuckoo GitHub repo. 
